var q=Object.defineProperty;var J=(n,r,o)=>r in n?q(n,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[r]=o;var y=(n,r,o)=>(J(n,typeof r!="symbol"?r+"":r,o),o);import{j as s}from"./FileViewer-CpM0iYLI.js";import{r as c}from"./index-B80Lgev0.js";import{B as P}from"./Base-CNIZEkp0.js";import{c as U}from"./ReactAppend-CBRQCQGz.js";import{r as R}from"./DxBox-CdMuSyGE.js";import{S as V}from"./sweetalert2.all-Dh0rZL5X.js";import{B as W}from"./Results-B9dLaNz0.js";import{M as z}from"./Modal-CbHkO7Dn.js";import{T as H}from"./Table-CEq6jy84.js";import{I as K}from"./ImageFormGroup-BhK-m0pl.js";import{I as Q}from"./InputFormGroup-DZ3W53Mr.js";import{D as S}from"./DxButton-CsjWvhyj.js";import{C as X}from"./CreateReactScript-Bj11ghWz.js";import{R as N}from"./ReactAppend-C-tNgxIf.js";import{S as D}from"./SwitchFormGroup-ChGOZLEW.js";import{L as Y}from"./Filter-1mRNSgu6.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./main-Br9xqDfn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BvL_iu_4.js";/* empty css               */class Z extends W{constructor(){super(...arguments);y(this,"path","admin/services");y(this,"hasFiles",!0)}}const h=new Z,ee=({brands:n})=>{const[r,o]=c.useState([]),p=c.useRef(),x=c.useRef(),g=c.useRef(),v=c.useRef(),b=c.useRef(),f=c.useRef(),[j,d]=c.useState([]),F=c.useRef(),[m,u]=c.useState([{value:""}]),[w,T]=c.useState(!1),E=e=>{const i=Array.from(e.target.files).map(l=>({file:l,url:URL.createObjectURL(l),isNew:!0}));d(l=>[...l,...i])},G=e=>{d(t=>t.filter((i,l)=>l!==e))},I=()=>{u([...m,{value:""}])},B=(e,t)=>{const i=[...m];i[e].value=t,u(i)},k=e=>{if(m.length<=1)return;const t=m.filter((i,l)=>l!==e);u(t)},C=e=>{if(o(e||null),T(!!(e!=null&&e.id)),g.current.value=(e==null?void 0:e.id)||"",v.current.value=(e==null?void 0:e.title)||"",b.current.value=(e==null?void 0:e.description)||"",f.current.value=null,e!=null&&e.image&&(f.image.src=`/api/service/media/${e.image}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const t=e.gallery.map(i=>({url:`/api/service/media/${i}`,isNew:!1}));d(t)}else d([]);e!=null&&e.characteristics&&e.characteristics.length>0?u(e.characteristics.map(t=>({value:t}))):u([{value:""}]),$(x.current).modal("show")},A=async e=>{e.preventDefault();const t=new FormData;t.append("title",v.current.value),t.append("description",b.current.value),w&&t.append("id",g.current.value),f.current.files[0]&&t.append("image",f.current.files[0]),j.filter(a=>a.isNew).forEach((a,_)=>{t.append(`gallery[${_}]`,a.file)});const i=j.filter(a=>!a.isNew).map(a=>a.url.split("/").pop());t.append("existing_gallery",JSON.stringify(i));const l=m.map(a=>a.value.trim()).filter(a=>a.length>0);t.append("characteristics",JSON.stringify(l)),await h.save(t)&&($(p.current).dxDataGrid("instance").refresh(),$(x.current).modal("hide"),d([]),u([{value:""}]))},L=async e=>{const{isConfirmed:t}=await V.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await h.delete(e)||$(p.current).dxDataGrid("instance").refresh()},M=async({id:e,value:t})=>{await h.boolean({id:e,field:"visible",value:t})&&$(p.current).dxDataGrid("instance").refresh()},O=async({id:e,value:t})=>{await h.boolean({id:e,field:"featured",value:t})&&$(p.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(H,{gridRef:p,title:"Servicios",rest:h,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>C()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:t})=>{e.html(R(s.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:t.description})))}},{dataField:"characteristics",caption:"Características",cellTemplate:(e,{data:t})=>{t.characteristics&&e.html(R(s.jsxs("ul",{className:"m-0 ps-3",style:{listStyle:"none"},children:[t.characteristics.slice(0,2).map((i,l)=>s.jsx("li",{className:"text-truncate",style:{maxWidth:"250px"},children:s.jsxs("small",{children:["• ",i]})},l)),t.characteristics.length>2&&s.jsx("li",{children:s.jsxs("small",{className:"text-muted",children:["+",t.characteristics.length-2," ","más..."]})})]})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:t})=>{N(e,s.jsx("img",{src:`/api/service/media/${t.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:i=>i.target.src="/images/default-thumbnail.jpg"}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),N(e,s.jsx(D,{checked:t.featured==1,onChange:()=>O({id:t.id,value:!t.featured})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),N(e,s.jsx(D,{checked:t.visible==1,onChange:()=>M({id:t.id,value:!t.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.append(S({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>C(t)})),e.append(S({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>L(t.id)}))}}]}),s.jsxs(z,{modalRef:x,title:w?"Editar Servicio":"Nuevo Servicio",onSubmit:A,size:"xl",children:[s.jsx("input",{ref:g,type:"hidden"}),s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx(Q,{eRef:v,label:"Título del servicio",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción"}),s.jsx("textarea",{ref:b,className:"form-control",rows:4,required:!0})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Características"}),m.map((e,t)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Duración de la sesión - 45 a 60 minutos",value:e.value,onChange:i=>B(t,i.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>k(t),disabled:m.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},t)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:I,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx(K,{eRef:f,label:"Imagen principal",aspect:16/9}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Galería de imágenes"}),s.jsx("input",{type:"file",ref:F,multiple:!0,accept:"image/*",onChange:E,className:"form-control"}),s.jsx("div",{className:"d-flex flex-wrap gap-2 mt-2",children:j.map((e,t)=>s.jsxs("div",{className:"position-relative",style:{width:"100px",height:"100px"},children:[s.jsx("img",{src:e.url,alt:"Preview",className:"img-thumbnail h-100 w-100 object-fit-cover"}),s.jsx("button",{type:"button",className:"btn btn-danger btn-xs position-absolute top-0 end-0",onClick:()=>G(t),children:"×"})]},t))})]})]})]})]})]})};X((n,r)=>{U(n).render(s.jsx(Y,{children:s.jsx(P,{...r,title:"Servicios",children:s.jsx(ee,{...r})})}))});
