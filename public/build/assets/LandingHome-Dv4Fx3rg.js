var Y=Object.defineProperty;var Z=(l,i,t)=>i in l?Y(l,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[i]=t;var M=(l,i,t)=>(Z(l,typeof i!="symbol"?i+"":i,t),t);import{j as e}from"./RequirementCard-CpM0iYLI.js";import{r as o}from"./index-B80Lgev0.js";import{c as _}from"./ReactAppend-CBRQCQGz.js";import{B as ee}from"./Base-BpN8bp9s.js";import{C as se}from"./CreateReactScript-Bj11ghWz.js";import{M as re}from"./Modal-NL5hMNXy.js";import{I as P}from"./InputFormGroup-C5uNEzQG.js";import{S as ie}from"./SwitchFormGroup-DPs-YKLp.js";import{I as ne}from"./ImageFormGroup-BXuoo0kQ.js";import"./sweetalert2.all-Dh0rZL5X.js";import{T as te}from"./TextareaFormGroup-DvJdl9tD.js";import{m as v}from"./main-Br9xqDfn.js";import{B as oe}from"./Results-DFOKnyj8.js";import"./index-DO3Aws4m.js";import"./tippy-react.esm-CHhA99mn.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./useTranslation-eU9E4S-_.js";import"./Filter-DhMUjbr-.js";/* empty css               */const ce=({id:l,col:i="col-12",label:t,eRef:d,required:u=!1,onChange:R=()=>{},onError:N="/api/cover/thumbnail/null"})=>{const[y,b]=o.useState(""),j=o.useRef(),g=o.useRef();o.useEffect(()=>{d&&(d.current={getFile:()=>j.current.files[0],setVideoSrc:p=>{b(p),g.current.src=p}})},[d]);const E=p=>{const k=p.target.files[0];if(k){const z=URL.createObjectURL(k);b(z),R(p)}};return e.jsxs("div",{className:`form-group ${i} mb-1`,children:[e.jsxs("label",{htmlFor:l,className:"mb-1",children:[t," ",u&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("video",{ref:g,controls:!0,src:y,style:{width:"100%",borderRadius:"4px",background:"#000",display:y?"block":"none"},onError:p=>{p.target.src=N}}),e.jsx("input",{id:l,type:"file",ref:j,accept:"video/*",onChange:E,className:"form-control mt-2"})]})};class le extends oe{constructor(){super(...arguments);M(this,"path","admin/landing_home");M(this,"hasFiles",!0);M(this,"translate",async t=>{try{const{status:d,result:u}=await v.Fetch(`/api/${this.path}/translate`,{method:"POST",body:JSON.stringify(t)});if(!d)throw new Error((u==null?void 0:u.message)||"Error al guardar traducción");return u}catch(d){return v.Notify.error(d.message),null}});M(this,"getByLang",async t=>{try{const{status:d,result:u}=await v.Fetch(`/api/${this.path}/by_lang/${t}`);if(!d)throw new Error((u==null?void 0:u.message)||"Error al obtener traducciones");return u}catch(d){return v.Notify.error(d.message),null}})}}const A=new le,ae=l=>{if(!l)return"home";const i=l.split("_");return i.length<2?"home":i[1]},U=({data:l,field:i,currentLangId:t,defaultLangId:d,onSave:u})=>{const[R,N]=o.useState(l[i]||""),[y,b]=o.useState(!1),j=t===d,g=!j,E=()=>{u(i,R),b(!1)};return e.jsx("div",{className:`d-flex gap-2 align-items-center ${g?"translation-field":""}`,children:j?e.jsx("span",{children:l[i]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control flex-grow-1",value:R,onChange:p=>{N(p.target.value),b(!0)},disabled:!g}),y&&g&&e.jsx("button",{className:"btn btn-xs btn-soft-primary",onClick:E,children:e.jsx("i",{className:"fa fa-save"})})]})})},de=({items:l,current_lang_id:i,default_lang_id:t})=>{const d=o.useRef(),[u,R]=o.useState("home"),[N,y]=o.useState(!1),[b,j]=o.useState(!1),[g,E]=o.useState(l),[p,k]=o.useState({}),[z,K]=o.useState(!1),w=o.useRef(null),F=o.useRef(null),L=o.useRef(null),T=o.useRef(null),C=o.useRef(null),V=o.useRef(null),B=o.useRef(null),O=o.useRef(null),D={home:"Inicio",services:"Servicios",solutions:"Soluciones",purchase:"Opciones de compra",partners:"Aliados comerciales",aboutus:"Nosotros",faqs:"Faqs",contact:"Contacto",blog:"Blog"};o.useEffect(()=>{(async()=>{if(i!==t){K(!0);try{const n=await A.getByLang(i),a={};n.forEach(r=>{r.original_id&&(a[r.original_id]=r)}),k(a)}catch(n){v.Notify.error("Error al cargar traducciones"),console.error("Error loading translations:",n)}finally{K(!1)}}else k({})})()},[i,t]);const I=g.reduce((s,n)=>{const a=ae(n.correlative);s[a]||(s[a]=[]);const r=p[n.original_id||n.id]||{},x={...n,title:i!==t&&r.title||n.title,subtitle:i!==t&&r.subtitle||n.subtitle,description:i!==t&&r.description||n.description,link:i!==t&&r.link||n.link,is_translated:!!r.id};return s[a].push(x),s},{});o.useEffect(()=>{var s;console.log("Items agrupados:",I),console.log("Items en home:",(s=I.home)==null?void 0:s.length)},[I]);const Q=s=>{s!=null&&s.id?y(!0):y(!1),setTimeout(()=>{w.current&&(w.current.value=(s==null?void 0:s.id)??""),F.current&&(F.current.value=(s==null?void 0:s.title)??""),L.current&&(L.current.value=(s==null?void 0:s.subtitle)??""),T.current&&(T.current.value=(s==null?void 0:s.description)??""),B.current&&(B.current.value=(s==null?void 0:s.link)??"");const n=(s==null?void 0:s.is_video)==="1"||(s==null?void 0:s.is_video)===1;O.current&&(O.current.checked=n,j(n)),n&&V.current&&(s!=null&&s.video)?V.current.setVideoSrc(`/api/landing_home/video/${s.video}`):C.current&&(s!=null&&s.image)&&(C.current.src=`/api/landing_home/media/${s==null?void 0:s.image}`)},100),$(d.current).modal("show")},X=async s=>{var n,a,r,x,m,h,c,q;s.preventDefault();try{const f=new FormData;if((n=w.current)!=null&&n.value&&f.append("id",w.current.value),(a=F.current)!=null&&a.value&&f.append("title",F.current.value),(r=L.current)!=null&&r.value&&f.append("subtitle",L.current.value),(x=T.current)!=null&&x.value&&f.append("description",T.current.value),(m=B.current)!=null&&m.value&&f.append("link",B.current.value),f.append("is_video",(h=O.current)!=null&&h.checked?"1":"0"),f.append("lang_id",t),b&&V.current){const W=V.current.getFile();W&&f.append("video",W)}else(q=(c=C.current)==null?void 0:c.files)!=null&&q[0]&&f.append("image",C.current.files[0]);if(!await A.save(f))return;const S=await A.getAll();S&&E(S),$(d.current).modal("hide"),v.Notify.success("Sección guardada correctamente")}catch(f){console.error("Error al enviar el formulario:",f),v.Notify.error("Hubo un error al enviar el formulario")}},H=async(s,n,a)=>{var r,x,m,h;try{const c=g.find(G=>G.id===s);if(!c)return;const q={original_id:c.original_id||c.id,[n]:a,lang_id:i,title:n==="title"?a:((r=p[c.id])==null?void 0:r.title)||c.title,subtitle:n==="subtitle"?a:((x=p[c.id])==null?void 0:x.subtitle)||c.subtitle,description:n==="description"?a:((m=p[c.id])==null?void 0:m.description)||c.description,link:n==="link"?a:((h=p[c.id])==null?void 0:h.link)||c.link},f=await A.translate(q);if(!f)return;k(G=>{const S={...G};return S[c.id]||(S[c.id]={...c,id:f.id,original_id:c.id,lang_id:i}),S[c.id][n]=a,S}),v.Notify.success("Traducción guardada correctamente")}catch(c){v.Notify.error("Error al guardar traducción"),console.error(c)}},J=i!==t;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`card ${J?"translation-mode":""}`,children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("ul",{className:"nav nav-tabs card-header-tabs",children:Object.keys(D).map(s=>e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${u===s?"active":""}`,onClick:()=>R(s),children:D[s]})},s))}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[J&&e.jsxs("span",{className:"badge bg-success me-2",style:{padding:"6px"},children:[e.jsx("i",{className:"fa fa-language me-1"})," Modo Traducción"]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>Q({correlative:`page_${u}_new`,lang_id:t}),children:[e.jsx("i",{className:"fa fa-plus me-1"})," Nueva Sección"]})]})]}),e.jsx("div",{className:"card-body",children:z?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"mt-2",children:"Cargando traducciones..."})]}):Object.keys(D).map(s=>{var n,a;return e.jsxs("div",{style:{display:u===s?"block":"none"},children:[e.jsxs("h4",{className:"mb-4",children:["Secciones de ",D[s]]}),e.jsxs("p",{className:"text-muted mb-3",children:["Mostrando ",((n=I[s])==null?void 0:n.length)||0," ","secciones"]}),((a=I[s])==null?void 0:a.length)===0?e.jsx("div",{className:"alert alert-info",children:"No hay secciones configuradas para esta página"}):e.jsx("div",{className:"row",children:(I[s]||[]).map(r=>{var x;return e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("div",{className:"card-header d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0",children:[((x=r.correlative)==null?void 0:x.split("_")[2])||"Sección",e.jsxs("small",{className:"text-muted ms-2",children:["(",r.correlative,")"]})]})}),e.jsxs("div",{className:"card-body",children:[r.is_video==="1"||r.is_video===1?e.jsx("video",{src:`/api/landing_home/video/${r.video}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:m=>m.target.src="/api/cover/thumbnail/null",controls:!0}):r.image?e.jsx("img",{src:`/api/landing_home/media/${r.image}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:m=>m.target.src="/api/cover/thumbnail/null"}):e.jsx("div",{className:"bg-light mb-3",style:{height:"200px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{className:"text-muted",children:"Sin imagen/video"})}),r.title&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Título:"}),e.jsx(U,{data:r,field:"title",currentLangId:i,defaultLangId:t,onSave:(m,h)=>H(r.id,m,h)})]}),r.subtitle&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtítulo:"}),e.jsx(U,{data:r,field:"subtitle",currentLangId:i,defaultLangId:t,onSave:(m,h)=>H(r.id,m,h)})]}),r.description&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Descripción:"}),e.jsx(U,{data:r,field:"description",currentLangId:i,defaultLangId:t,onSave:(m,h)=>H(r.id,m,h)})]}),r.link&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Enlace:"}),e.jsx(U,{data:r,field:"link",currentLangId:i,defaultLangId:t,onSave:(m,h)=>H(r.id,m,h)})]})]}),e.jsx("div",{className:"card-footer d-flex justify-content-end",children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>Q(r),disabled:J,children:[e.jsx("i",{className:"fa fa-edit"})," ","Editar"]})})]})},r.id)})})]},s)})})]}),e.jsx(re,{modalRef:d,title:N?"Editar sección":"Agregar sección",onSubmit:X,size:"lg",children:e.jsxs("div",{className:"row",id:"principal-container",children:[e.jsx("input",{ref:w,type:"hidden"}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(P,{eRef:F,label:"Título",placeholder:"Título principal de la sección",required:!0}),e.jsx(P,{eRef:L,label:"Subtítulo",placeholder:"Subtítulo opcional"}),e.jsx(te,{eRef:T,label:"Descripción",rows:3,placeholder:"Descripción detallada de la sección"}),e.jsx(P,{eRef:B,label:"Enlace",placeholder:"https://ejemplo.com"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(ie,{eRef:O,onChange:s=>j(s.target.checked),label:"Usar video en lugar de imagen",specification:"Solo se mostrará el video en la sección"}),b?e.jsx(ce,{eRef:V,label:"Video",col:"col-12",required:!N}):e.jsx(ne,{eRef:C,label:"Imagen",col:"col-12",aspect:16/9,fit:"contain",required:!N})]})]})})]})};se((l,i)=>{_(l).render(e.jsx(ee,{...i,title:"Landing Inicio",children:e.jsx(de,{...i})}))});
