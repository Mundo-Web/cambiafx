var z=Object.defineProperty;var A=(s,i,l)=>i in s?z(s,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[i]=l;var S=(s,i,l)=>(A(s,typeof i!="symbol"?i+"":i,l),l);import{j as r}from"./RequirementCard-DEdD30eg.js";import{r as o}from"./index-RYns6xqu.js";import{c as V}from"./ReactAppend-vpV7VTGG.js";import{B as W}from"./Base-DtR8s_bv.js";import{C as L}from"./CreateReactScript-BuKYEKxn.js";import{T as H}from"./Table-CyG7yWBs.js";import{M as J}from"./Modal-1_SBF_XS.js";import{I as p}from"./InputFormGroup-B7mKwzkx.js";import{R as k}from"./ReactAppend-DPXaoPQG.js";import{D}from"./DxButton-CsjWvhyj.js";import{S as K}from"./SwitchFormGroup-SB6Qzl6-.js";import{I as Q}from"./ImageFormGroup-Csvj9Cte.js";import{S as E}from"./sweetalert2.all-DJo0UVK6.js";import{B as U}from"./Results-BBVbNL2k.js";import{r as d}from"./DxBox-DZgBbgD6.js";import{T as X}from"./TextareaFormGroup-B4XWcpu0.js";import{S as G}from"./SelectFormGroup-CVn9r_7Q.js";import"./index-CXU7o9CY.js";import"./tippy-react.esm-DYFqe69e.js";/* empty css              */import"./Logout-BlWggqgx.js";import"./main-Y8JAyXgE.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./index.esm-zkRd-kwu.js";import"./axios-B4uVmeYG.js";import"./useTranslation-CZbMeh78.js";import"./Filter-CpekYgBC.js";/* empty css               */class Y extends U{constructor(){super(...arguments);S(this,"path","admin/banners");S(this,"hasFiles",!0)}}const f=new Y,Z=({sections:s,positions:i,sectionPositions:l})=>{const a=o.useRef(),b=o.useRef(),x=o.useRef(),h=o.useRef(),v=o.useRef(),m=o.useRef(),g=o.useRef(),j=o.useRef(),R=o.useRef(),c=o.useRef(),w=o.useRef(),[I,F]=o.useState(!1),[ee,T]=o.useState("home"),[_,C]=o.useState(l.home||{}),O=e=>{T(e);const n=l[e]||{};C(n);const t=Object.keys(n)[0];c.current&&(c.current.value=t||"",$(c.current).trigger("change"))},N=e=>{e!=null&&e.id?F(!0):F(!1);const n=(e==null?void 0:e.section)??"home",t=(e==null?void 0:e.position)??Object.keys(l[n]||{})[0];T(n),C(l[n]||{}),x.current.value=(e==null?void 0:e.id)??"",h.current.value=(e==null?void 0:e.name)??"",v.current.value=(e==null?void 0:e.description)??"",m.image.src=`/api/banners/media/${e==null?void 0:e.image}`,m.current.value=null,g.current.value=(e==null?void 0:e.button_text)??"",j.current.value=(e==null?void 0:e.button_link)??"",R.current.value=n,c.current.value=t,w.current.value=(e==null?void 0:e.order)??0,$(b.current).modal("show")},P=async e=>{e.preventDefault();try{const n={id:x.current.value||void 0,name:h.current.value,description:v.current.value,button_text:g.current.value,button_link:j.current.value,section:R.current.value,position:c.current.value,order:parseInt(w.current.value)||0},t=new FormData;for(const B in n)t.append(B,n[B]);const u=m.current.files[0];u&&t.append("image",u);const y=await f.save(t);if(console.log(y),!y)return;console.log("Refrescando tabla..."),$(a.current).dxDataGrid("instance").refresh(),console.log("Cerrando modal..."),$(b.current).modal("hide")}catch(n){console.error("Error al enviar el formulario:",n),E.fire({icon:"error",title:"Error",text:"Hubo un error al enviar el formulario. Por favor, inténtalo de nuevo."})}},M=async({id:e,value:n})=>{await f.boolean({id:e,field:"visible",value:n})&&$(a.current).dxDataGrid("instance").refresh()},q=async e=>{const{isConfirmed:n}=await E.fire({title:"Eliminar banner",text:"¿Estás seguro de eliminar este banner?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!n||!await f.delete(e)||$(a.current).dxDataGrid("instance").refresh()};return r.jsxs(r.Fragment,{children:[r.jsx(H,{gridRef:a,title:"Banners",rest:f,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo banner",hint:"Nuevo banner",onClick:()=>N()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"image",caption:"Imagen",width:"80px",allowFiltering:!1,cellTemplate:(e,{data:n})=>{k(e,r.jsx("img",{src:`/api/banners/media/${n.image}`,style:{width:"70px",height:"40px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"}}))}},{dataField:"name",caption:"Contenido",width:"40%",cellTemplate:(e,{data:n})=>{k(e,r.jsxs("div",{children:[r.jsx("p",{className:"mb-1",children:r.jsx("b",{children:n.name})}),n.description&&r.jsx("small",{className:"text-wrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:n.description}),n.button_text&&r.jsx("div",{className:"mt-1",children:r.jsx("small",{className:"badge badge-info",children:n.button_text})})]}))}},{dataField:"section",caption:"Sección",width:"120px",cellTemplate:(e,{data:n})=>{const t=s[n.section]||n.section;e.html(d(r.jsx("span",{className:"badge text-black badge-primary",children:t})))}},{dataField:"position",caption:"Posición",width:"120px",cellTemplate:(e,{data:n})=>{const u=(l[n.section]||{})[n.position]||n.position;e.html(d(r.jsx("span",{className:"badge text-black badge-secondary",children:u})))}},{dataField:"order",caption:"Orden",width:"80px",dataType:"number"},{dataField:"button_link",caption:"Mensaje personalizado",cellTemplate:(e,{data:n})=>{n.button_link?e.html(d(r.jsx("a",{href:"#",className:"text-truncate d-block",style:{maxWidth:"200px"},children:n.button_link}))):e.html(d(r.jsx("i",{className:"text-muted",children:"- Sin mensaje personalizado -"})))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"120px",cellTemplate:(e,{data:n})=>{k(e,r.jsx(K,{checked:n.visible,onChange:t=>M({id:n.id,value:t.target.checked})}))}},{caption:"Acciones",cellTemplate:(e,{data:n})=>{e.css("text-overflow","unset"),e.append(D({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>N(n)})),e.append(D({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>q(n.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsx(J,{modalRef:b,title:I?"Editar banner":"Agregar banner",onSubmit:P,size:"lg",children:r.jsxs("div",{className:"row",id:"form-banner",children:[r.jsx("input",{ref:x,type:"hidden"}),r.jsx(Q,{eRef:m,label:"Imagen del banner",col:"col-md-4",aspect:2.5,fit:"cover",required:!0}),r.jsxs("div",{className:"col-md-8",children:[r.jsx(p,{eRef:h,label:"Título del banner",required:!0}),r.jsx(X,{eRef:v,label:"Descripción",rows:2}),r.jsxs("div",{className:"row",children:[r.jsx(p,{eRef:g,label:"Texto del botón",col:"col-md-6"}),r.jsx(p,{eRef:j,label:"Mensaje personalizado del botón",col:"col-md-6"})]})]}),r.jsx(G,{eRef:R,label:"Sección",col:"col-md-4",required:!0,dropdownParent:"#form-banner",onChange:e=>O(e.target.value),children:Object.entries(s).map(([e,n])=>r.jsx("option",{value:e,children:n},e))}),r.jsx(G,{eRef:c,label:"Posición",col:"col-md-4",required:!0,dropdownParent:"#form-banner",children:Object.entries(_).map(([e,n])=>r.jsx("option",{value:e,children:n},e))}),r.jsx(p,{eRef:w,label:"Orden",type:"number",col:"col-md-4",defaultValue:0})]})})]})};L((s,i)=>{V(s).render(r.jsx(W,{...i,title:"Banners",children:r.jsx(Z,{...i})}))});
