var pe=Object.defineProperty;var fe=(o,r,u)=>r in o?pe(o,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[r]=u;var P=(o,r,u)=>(fe(o,typeof r!="symbol"?r+"":r,u),u);import{j as i}from"./RequirementCard-CpM0iYLI.js";import{r as n}from"./index-B80Lgev0.js";import{c as de}from"./ReactAppend-CBRQCQGz.js";import{B as he}from"./Base-BG-6Di3L.js";import{r as ge}from"./DxBox-CdMuSyGE.js";import"./sweetalert2.all-Dh0rZL5X.js";import{M as be}from"./Modal-DJyFGvYY.js";import{T as ve}from"./Table-C3CodGPR.js";import{I as G}from"./ImageFormGroup-BXuoo0kQ.js";import{I as C}from"./InputFormGroup-C5uNEzQG.js";import{D as W}from"./DxButton-CsjWvhyj.js";import{C as je}from"./CreateReactScript-Bj11ghWz.js";import{R as xe}from"./ReactAppend-C-tNgxIf.js";import{L as Re}from"./Filter-DhMUjbr-.js";import{D as Q,S as Ne}from"./SelectAPIFormGroupSupport-DC_Yo552.js";import{B as Ce}from"./Results-DFOKnyj8.js";import"./index-DO3Aws4m.js";import"./tippy-react.esm-CHhA99mn.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./main-Br9xqDfn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./useTranslation-eU9E4S-_.js";/* empty css               */import"./index-CqrOtH36.js";class ye extends Ce{constructor(){super(...arguments);P(this,"path","admin/purchaseOptions");P(this,"hasFiles",!0)}}const we=({requirement:o,index:r,onUpdate:u,onRemove:v,onAddCharacteristic:d,onUpdateCharacteristic:y,onRemoveCharacteristic:j})=>i.jsx("div",{className:"card mb-3",children:i.jsxs("div",{className:"card-body",children:[i.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[i.jsxs("h6",{children:["Requisito #",r+1]}),i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>v(r),children:"Eliminar Requisito"})]}),i.jsx(C,{label:"Título del requisito",value:o.title,onChange:p=>u(r,"title",p.target.value)}),i.jsx(Q,{current:"purchaseOption",label:"Imagen del requisito",currentImage:o.image,onChange:p=>u(r,"image",p),aspect:16/9}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Características"}),o.characteristics.map((p,h)=>i.jsxs("div",{className:"input-group mb-2",children:[i.jsx("input",{type:"text",className:"form-control",value:p,onChange:x=>y(r,h,x.target.value)}),i.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>j(r,h),disabled:o.characteristics.length<=1,children:i.jsx("i",{className:"fa fa-times"})})]},`req-${r}-char-${h}`)),i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>d(r),children:"Agregar Característica"})]})]})}),J=new ye,K=({feature:o,index:r,onUpdate:u,onRemove:v,type:d,canRemove:y,characteristics:j,benefits:p,addCharacteristic:h,addBenefit:x})=>{const w=(f,D)=>{u(r,f,D)},B=f=>{u(r,"image",f)};return i.jsx("div",{className:"card mb-3",children:i.jsxs("div",{className:"card-body",children:[i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-6",children:[i.jsx(C,{label:"Título",value:o.title,onChange:f=>w("title",f.target.value)}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{className:"form-control",rows:3,value:o.description,onChange:f=>w("description",f.target.value)})]})]}),i.jsx("div",{className:"col-md-6",children:i.jsx(Q,{current:"purchaseOption",label:"Imagen",currentImage:o.image,onChange:B,aspect:16/9})})]}),i.jsxs("div",{className:"d-flex justify-content-between",children:[i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>v(r),disabled:!y,children:"Eliminar"}),d==="characteristic"&&r===j.length-1||d==="benefit"&&r===p.length-1?i.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:d==="characteristic"?h:x,children:["Agregar"," ",d==="characteristic"?"Característica":"Beneficio"]}):null]})]})})},_e=({brands:o})=>{var V;const r=n.useRef(),u=n.useRef(),v=n.useRef(),d=n.useRef(),y=n.useRef(),j=n.useRef(),p=n.useRef(),h=n.useRef(),x=n.useRef(),w=n.useRef(),B=n.useRef(),f=n.useRef(),D=n.useRef(),F=n.useRef(),O=n.useRef(),A=n.useRef(),[X,M]=n.useState(!1),[T,Y]=n.useState(null),[g,S]=n.useState([{title:"",description:"",image:void 0}]),[b,q]=n.useState([{title:"",description:"",image:void 0}]),[_,R]=n.useState([{title:"",image:void 0,characteristics:[""]}]),[Z,H]=n.useState(""),L=()=>{S([...g,{title:"",description:"",image:void 0}])},ee=n.useCallback((e,s,c)=>{S(l=>{const a=[...l];return a[e]={...a[e],[s]:c},a})},[]),ie=e=>{g.length<=1||S(g.filter((s,c)=>c!==e))},U=()=>{q([...b,{title:"",description:"",image:void 0}])},se=n.useCallback((e,s,c)=>{q(l=>{const a=[...l];return a[e]={...a[e],[s]:c},a})},[]),te=e=>{b.length<=1||q(b.filter((s,c)=>c!==e))},re=()=>{R([..._,{title:"",image:void 0,characteristics:[""]}])},ce=(e,s,c)=>{R(l=>l.map((a,N)=>N===e?{...a,[s]:c}:a))},ne=e=>{_.length<=1||R(_.filter((s,c)=>c!==e))},ae=(e,s,c)=>{R(l=>l.map((a,N)=>{if(N===e){const I=[...a.characteristics];return I[s]=c,{...a,characteristics:I}}return a}))},oe=e=>{R(s=>s.map((c,l)=>l===e?{...c,characteristics:[...c.characteristics,""]}:c))},le=(e,s)=>{R(c=>c.map((l,a)=>a===e?{...l,characteristics:l.characteristics.filter((N,I)=>I!==s)}:l))},z=e=>{e!=null&&e.id?M(!0):M(!1),v.current.value=(e==null?void 0:e.id)??"",d.current.value=(e==null?void 0:e.title)??"",y.current.value=(e==null?void 0:e.category.name)??"",H(e==null?void 0:e.category.name),Y(e),j.current.value=(e==null?void 0:e.description)??"",p.current.value=(e==null?void 0:e.how_it_helps)??"",h.current.value=(e==null?void 0:e.description_helps)??"",x.current.value=(e==null?void 0:e.value_proposition)??"",w.current.value=(e==null?void 0:e.innovation_focus)??"",B.current.value=(e==null?void 0:e.customer_relation)??"",f.current.value=(e==null?void 0:e.how_it_requirements)??"",D.current.value=(e==null?void 0:e.description_requirements)??"",F.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image)??"undefined"}`,O.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image_secondary)??"undefined"}`,A.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image_banner)??"undefined"}`,e!=null&&e.characteristics&&S(e.characteristics.map(s=>({title:s.title,description:s.description,image:s.image}))),e!=null&&e.benefits&&q(e.benefits.map(s=>({title:s.title,description:s.description,image:s.image}))),e!=null&&e.requirements&&R(e.requirements.map(s=>({title:s.title||"",image:s.image||void 0,characteristics:s.characteristics||[""]}))),$(u.current).modal("show")},me=async e=>{e.preventDefault();const s=new FormData,c={id:v.current.value||void 0,title:d.current.value,description:j.current.value,how_it_helps:p.current.value,description_helps:h.current.value,value_proposition:x.current.value,innovation_focus:w.current.value,customer_relation:B.current.value,how_it_requirements:f.current.value,description_requirements:D.current.value};for(const t in c)s.append(t,c[t]);const l=F.current.files[0];l&&s.append("image",l);const a=O.current.files[0];a&&s.append("image_secondary",a);const N=A.current.files[0];N&&s.append("image_banner",N),g.forEach((t,m)=>{s.append(`characteristics[${m}][title]`,t.title),s.append(`characteristics[${m}][description]`,t.description),t.image&&(t.image.file?s.append(`characteristics[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`characteristics[${m}][existing_image]`,t.image))}),b.forEach((t,m)=>{s.append(`benefits[${m}][title]`,t.title),s.append(`benefits[${m}][description]`,t.description),t.image&&(t.image.file?s.append(`benefits[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`benefits[${m}][existing_image]`,t.image))}),_.map((t,m)=>{var k;const E={title:t.title,characteristics:t.characteristics.filter(ue=>ue.trim()!=="")};return(k=t.image)!=null&&k.file?s.append(`requirements[${m}][image]`,t.image.file):typeof t.image=="string"&&(E.image=t.image),E}).forEach((t,m)=>{s.append(`requirements[${m}][title]`,t.title),t.image&&(typeof t.image=="object"&&t.image.file?s.append(`requirements[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`requirements[${m}][existing_image]`,t.image)),t.characteristics.forEach((E,k)=>{s.append(`requirements[${m}][characteristics][${k}]`,E)})}),s.append("category_name",Z),await J.save(s)&&($(r.current).dxDataGrid("instance").refresh(),$(u.current).modal("hide"))};return i.jsxs(i.Fragment,{children:[i.jsx(ve,{gridRef:r,title:"Opciones de compra",rest:J,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nueva opción de compra",onClick:()=>z()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:s})=>{e.html(ge(i.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:s.description})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:s})=>{xe(e,i.jsx("img",{src:`/api/purchaseOption/media/${s.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:c=>c.target.src="/images/default-thumbnail.jpg"}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.append(W({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>z(s)})),e.append(W({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>onDeleteClicked(s.id)}))}}]}),i.jsxs(be,{modalRef:u,title:X?"Editar Opción de Compra":"Nueva Opción de Compra",onSubmit:me,size:"lg",children:[i.jsx("input",{ref:v,type:"hidden"}),i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-6",id:"purchase-container",children:[i.jsx(Ne,{eRef:y,dropdownParent:"#purchase-container",label:"Categoría",searchAPI:"/api/admin/category_purcharse_options/paginate",searchBy:"name",allowCreate:!0,onChange:e=>H(e),initialValue:((V=T==null?void 0:T.category)==null?void 0:V.name)||""}),i.jsx(C,{eRef:d,label:"Título de la opción de compra",required:!0}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{ref:j,className:"form-control",rows:4,required:!0})]})]}),i.jsxs("div",{className:"col-md-6",children:[i.jsx(C,{eRef:p,label:"Cómo ayuda"}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción de ayuda"}),i.jsx("textarea",{ref:h,className:"form-control",rows:4})]})]})]}),i.jsxs("div",{className:"row mt-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(G,{eRef:F,label:"Imagen principal",aspect:16/9})}),i.jsx("div",{className:"col-md-6",children:i.jsx(G,{eRef:O,label:"Imagen secundaria",aspect:16/9})}),i.jsx("div",{className:"col-md-12 mt-3",children:i.jsx(G,{eRef:A,label:"Banner",aspect:16/9})})]}),i.jsx("div",{className:"row mt-3",children:i.jsxs("div",{className:"col-12",children:[i.jsx(C,{eRef:x,label:"Propuesta de valor"}),i.jsx("h5",{className:"mb-3",children:"Características"}),g.map((e,s)=>i.jsx(K,{feature:e,index:s,onUpdate:ee,onRemove:ie,canRemove:g.length>1,type:"characteristic",characteristics:g,benefits:b,addCharacteristic:L,addBenefit:U},`char-${s}`))]})}),i.jsxs("div",{className:"row mt-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(C,{eRef:w,label:"Enfoque de innovación"})}),i.jsx("div",{className:"col-md-6",children:i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Relación con el cliente"}),i.jsx("textarea",{ref:B,className:"form-control",rows:5})]})}),i.jsxs("div",{className:"col-md-12",children:[i.jsx("h5",{className:"mb-3 mt-4",children:"Beneficios"}),b.map((e,s)=>i.jsx(K,{feature:e,index:s,onUpdate:se,onRemove:te,canRemove:b.length>1,type:"benefit",characteristics:g,benefits:b,addCharacteristic:L,addBenefit:U},`benefit-${s}`))]})]}),i.jsx("div",{className:"row mt-3",children:i.jsxs("div",{className:"col-12",children:[i.jsx("h5",{className:"mb-3",children:"Requisitos"}),i.jsxs("div",{className:"mb-3",children:[i.jsx(C,{eRef:f,label:"Cómo funciona los requisitos"}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción de requisitos"}),i.jsx("textarea",{ref:D,className:"form-control",rows:4})]})]}),_&&_.map((e,s)=>i.jsx(we,{requirement:e,index:s,onUpdate:ce,onRemove:ne,onAddCharacteristic:oe,onUpdateCharacteristic:ae,onRemoveCharacteristic:le},`requirement-${s}`)),i.jsxs("button",{type:"button",className:"btn btn-primary mt-2",onClick:re,children:[i.jsx("i",{className:"fa fa-plus me-2"})," Agregar Requisito"]})]})})]})]})};je((o,r)=>{de(o).render(i.jsx(Re,{children:i.jsx(he,{...r,title:"Opción de Compras",children:i.jsx(_e,{...r})})}))});
