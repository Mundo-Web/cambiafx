var ne=Object.defineProperty;var ae=(l,r,u)=>r in l?ne(l,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[r]=u;var T=(l,r,u)=>(ae(l,typeof r!="symbol"?r+"":r,u),u);import{j as i}from"./RequirementCard-CpM0iYLI.js";import{r as n}from"./index-B80Lgev0.js";import{c as le}from"./ReactAppend-CBRQCQGz.js";import{B as oe}from"./Base-BG-6Di3L.js";import{r as me}from"./DxBox-CdMuSyGE.js";import"./sweetalert2.all-Dh0rZL5X.js";import{M as ue}from"./Modal-DJyFGvYY.js";import{T as pe}from"./Table-C3CodGPR.js";import{I as A}from"./ImageFormGroup-BXuoo0kQ.js";import{I as w}from"./InputFormGroup-C5uNEzQG.js";import{D as L}from"./DxButton-CsjWvhyj.js";import{C as fe}from"./CreateReactScript-Bj11ghWz.js";import{R as de}from"./ReactAppend-C-tNgxIf.js";import{L as he}from"./Filter-DhMUjbr-.js";import{D as W}from"./DragDropImage-BzrJOcw6.js";import{B as ge}from"./Results-DFOKnyj8.js";import"./index-DO3Aws4m.js";import"./tippy-react.esm-CHhA99mn.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./main-Br9xqDfn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./useTranslation-eU9E4S-_.js";/* empty css               */import"./index-CqrOtH36.js";class be extends ge{constructor(){super(...arguments);T(this,"path","admin/purchaseOptions");T(this,"hasFiles",!0)}}const ve=({requirement:l,index:r,onUpdate:u,onRemove:v,onAddCharacteristic:d,onUpdateCharacteristic:j,onRemoveCharacteristic:x})=>i.jsx("div",{className:"card mb-3",children:i.jsxs("div",{className:"card-body",children:[i.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[i.jsxs("h6",{children:["Requisito #",r+1]}),i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>v(r),children:"Eliminar Requisito"})]}),i.jsx(w,{label:"Título del requisito",value:l.title,onChange:p=>u(r,"title",p.target.value)}),i.jsx(W,{current:"purchaseOption",label:"Imagen del requisito",currentImage:l.image,onChange:p=>u(r,"image",p),aspect:16/9}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Características"}),l.characteristics.map((p,h)=>i.jsxs("div",{className:"input-group mb-2",children:[i.jsx("input",{type:"text",className:"form-control",value:p,onChange:R=>j(r,h,R.target.value)}),i.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>x(r,h),disabled:l.characteristics.length<=1,children:i.jsx("i",{className:"fa fa-times"})})]},`req-${r}-char-${h}`)),i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>d(r),children:"Agregar Característica"})]})]})}),U=new be,z=({feature:l,index:r,onUpdate:u,onRemove:v,type:d,canRemove:j,characteristics:x,benefits:p,addCharacteristic:h,addBenefit:R})=>{const y=(f,B)=>{u(r,f,B)},D=f=>{u(r,"image",f)};return i.jsx("div",{className:"card mb-3",children:i.jsxs("div",{className:"card-body",children:[i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-6",children:[i.jsx(w,{label:"Título",value:l.title,onChange:f=>y("title",f.target.value)}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{className:"form-control",rows:3,value:l.description,onChange:f=>y("description",f.target.value)})]})]}),i.jsx("div",{className:"col-md-6",children:i.jsx(W,{current:"purchaseOption",label:"Imagen",currentImage:l.image,onChange:D,aspect:16/9})})]}),i.jsxs("div",{className:"d-flex justify-content-between",children:[i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>v(r),disabled:!j,children:"Eliminar"}),d==="characteristic"&&r===x.length-1||d==="benefit"&&r===p.length-1?i.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:d==="characteristic"?h:R,children:["Agregar"," ",d==="characteristic"?"Característica":"Beneficio"]}):null]})]})})},je=({brands:l})=>{const r=n.useRef(),u=n.useRef(),v=n.useRef(),d=n.useRef(),j=n.useRef(),x=n.useRef(),p=n.useRef(),h=n.useRef(),R=n.useRef(),y=n.useRef(),D=n.useRef(),f=n.useRef(),B=n.useRef(),F=n.useRef(),S=n.useRef(),[J,P]=n.useState(!1);n.useState(null);const[g,E]=n.useState([{title:"",description:"",image:void 0}]),[b,I]=n.useState([{title:"",description:"",image:void 0}]),[_,N]=n.useState([{title:"",image:void 0,characteristics:[""]}]),G=()=>{E([...g,{title:"",description:"",image:void 0}])},K=n.useCallback((e,s,c)=>{E(o=>{const a=[...o];return a[e]={...a[e],[s]:c},a})},[]),Q=e=>{g.length<=1||E(g.filter((s,c)=>c!==e))},M=()=>{I([...b,{title:"",description:"",image:void 0}])},V=n.useCallback((e,s,c)=>{I(o=>{const a=[...o];return a[e]={...a[e],[s]:c},a})},[]),X=e=>{b.length<=1||I(b.filter((s,c)=>c!==e))},Y=()=>{N([..._,{title:"",image:void 0,characteristics:[""]}])},Z=(e,s,c)=>{N(o=>o.map((a,C)=>C===e?{...a,[s]:c}:a))},ee=e=>{_.length<=1||N(_.filter((s,c)=>c!==e))},ie=(e,s,c)=>{N(o=>o.map((a,C)=>{if(C===e){const q=[...a.characteristics];return q[s]=c,{...a,characteristics:q}}return a}))},se=e=>{N(s=>s.map((c,o)=>o===e?{...c,characteristics:[...c.characteristics,""]}:c))},te=(e,s)=>{N(c=>c.map((o,a)=>a===e?{...o,characteristics:o.characteristics.filter((C,q)=>q!==s)}:o))},H=e=>{e!=null&&e.id?P(!0):P(!1),v.current.value=(e==null?void 0:e.id)??"",d.current.value=(e==null?void 0:e.title)??"",j.current.value=(e==null?void 0:e.description)??"",x.current.value=(e==null?void 0:e.how_it_helps)??"",p.current.value=(e==null?void 0:e.description_helps)??"",h.current.value=(e==null?void 0:e.value_proposition)??"",R.current.value=(e==null?void 0:e.innovation_focus)??"",y.current.value=(e==null?void 0:e.customer_relation)??"",D.current.value=(e==null?void 0:e.how_it_requirements)??"",f.current.value=(e==null?void 0:e.description_requirements)??"",B.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image)??"undefined"}`,F.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image_secondary)??"undefined"}`,S.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image_banner)??"undefined"}`,e!=null&&e.characteristics&&E(e.characteristics.map(s=>({title:s.title,description:s.description,image:s.image}))),e!=null&&e.benefits&&I(e.benefits.map(s=>({title:s.title,description:s.description,image:s.image}))),e!=null&&e.requirements&&N(e.requirements.map(s=>({title:s.title||"",image:s.image||void 0,characteristics:s.characteristics||[""]}))),$(u.current).modal("show")},re=async e=>{e.preventDefault();const s=new FormData,c={id:v.current.value||void 0,title:d.current.value,description:j.current.value,how_it_helps:x.current.value,description_helps:p.current.value,value_proposition:h.current.value,innovation_focus:R.current.value,customer_relation:y.current.value,how_it_requirements:D.current.value,description_requirements:f.current.value};for(const t in c)s.append(t,c[t]);const o=B.current.files[0];o&&s.append("image",o);const a=F.current.files[0];a&&s.append("image_secondary",a);const C=S.current.files[0];C&&s.append("image_banner",C),g.forEach((t,m)=>{s.append(`characteristics[${m}][title]`,t.title),s.append(`characteristics[${m}][description]`,t.description),t.image&&(t.image.file?s.append(`characteristics[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`characteristics[${m}][existing_image]`,t.image))}),b.forEach((t,m)=>{s.append(`benefits[${m}][title]`,t.title),s.append(`benefits[${m}][description]`,t.description),t.image&&(t.image.file?s.append(`benefits[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`benefits[${m}][existing_image]`,t.image))}),_.map((t,m)=>{var O;const k={title:t.title,characteristics:t.characteristics.filter(ce=>ce.trim()!=="")};return(O=t.image)!=null&&O.file?s.append(`requirements[${m}][image]`,t.image.file):typeof t.image=="string"&&(k.image=t.image),k}).forEach((t,m)=>{s.append(`requirements[${m}][title]`,t.title),t.image&&(typeof t.image=="object"&&t.image.file?s.append(`requirements[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`requirements[${m}][existing_image]`,t.image)),t.characteristics.forEach((k,O)=>{s.append(`requirements[${m}][characteristics][${O}]`,k)})}),await U.save(s)&&($(r.current).dxDataGrid("instance").refresh(),$(u.current).modal("hide"))};return i.jsxs(i.Fragment,{children:[i.jsx(pe,{gridRef:r,title:"Opciones de compra",rest:U,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nueva opción de compra",onClick:()=>H()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:s})=>{e.html(me(i.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:s.description})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:s})=>{de(e,i.jsx("img",{src:`/api/purchaseOption/media/${s.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:c=>c.target.src="/images/default-thumbnail.jpg"}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.append(L({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>H(s)})),e.append(L({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>onDeleteClicked(s.id)}))}}]}),i.jsxs(ue,{modalRef:u,title:J?"Editar Opción de Compra":"Nueva Opción de Compra",onSubmit:re,size:"lg",children:[i.jsx("input",{ref:v,type:"hidden"}),i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-6",children:[i.jsx(w,{eRef:d,label:"Título de la opción de compra",required:!0}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{ref:j,className:"form-control",rows:4,required:!0})]})]}),i.jsxs("div",{className:"col-md-6",children:[i.jsx(w,{eRef:x,label:"Cómo ayuda"}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción de ayuda"}),i.jsx("textarea",{ref:p,className:"form-control",rows:4})]})]})]}),i.jsxs("div",{className:"row mt-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(A,{eRef:B,label:"Imagen principal",aspect:16/9})}),i.jsx("div",{className:"col-md-6",children:i.jsx(A,{eRef:F,label:"Imagen secundaria",aspect:16/9})}),i.jsx("div",{className:"col-md-12 mt-3",children:i.jsx(A,{eRef:S,label:"Banner",aspect:16/9})})]}),i.jsx("div",{className:"row mt-3",children:i.jsxs("div",{className:"col-12",children:[i.jsx(w,{eRef:h,label:"Propuesta de valor"}),i.jsx("h5",{className:"mb-3",children:"Características"}),g.map((e,s)=>i.jsx(z,{feature:e,index:s,onUpdate:K,onRemove:Q,canRemove:g.length>1,type:"characteristic",characteristics:g,benefits:b,addCharacteristic:G,addBenefit:M},`char-${s}`))]})}),i.jsxs("div",{className:"row mt-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(w,{eRef:R,label:"Enfoque de innovación"})}),i.jsx("div",{className:"col-md-6",children:i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Relación con el cliente"}),i.jsx("textarea",{ref:y,className:"form-control",rows:5})]})}),i.jsxs("div",{className:"col-md-12",children:[i.jsx("h5",{className:"mb-3 mt-4",children:"Beneficios"}),b.map((e,s)=>i.jsx(z,{feature:e,index:s,onUpdate:V,onRemove:X,canRemove:b.length>1,type:"benefit",characteristics:g,benefits:b,addCharacteristic:G,addBenefit:M},`benefit-${s}`))]})]}),i.jsx("div",{className:"row mt-3",children:i.jsxs("div",{className:"col-12",children:[i.jsx("h5",{className:"mb-3",children:"Requisitos"}),i.jsxs("div",{className:"mb-3",children:[i.jsx(w,{eRef:D,label:"Cómo funciona los requisitos"}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción de requisitos"}),i.jsx("textarea",{ref:f,className:"form-control",rows:4})]})]}),_&&_.map((e,s)=>i.jsx(ve,{requirement:e,index:s,onUpdate:Z,onRemove:ee,onAddCharacteristic:se,onUpdateCharacteristic:ie,onRemoveCharacteristic:te},`requirement-${s}`)),i.jsxs("button",{type:"button",className:"btn btn-primary mt-2",onClick:Y,children:[i.jsx("i",{className:"fa fa-plus me-2"})," Agregar Requisito"]})]})})]})]})};fe((l,r)=>{le(l).render(i.jsx(he,{children:i.jsx(oe,{...r,title:"Opción de Compras",children:i.jsx(je,{...r})})}))});
