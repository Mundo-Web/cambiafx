var J=Object.defineProperty;var K=(o,s,l)=>s in o?J(o,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[s]=l;var C=(o,s,l)=>(K(o,typeof s!="symbol"?s+"":s,l),l);import{j as t}from"./RequirementCard-DEdD30eg.js";import{r}from"./index-RYns6xqu.js";import{c as Q}from"./ReactAppend-vpV7VTGG.js";import{B as U}from"./Base-BjhDtDDi.js";import{C as X}from"./CreateReactScript-BuKYEKxn.js";import{T as Z}from"./Table-CyG7yWBs.js";import{M as ee}from"./Modal-1_SBF_XS.js";import{I as f}from"./InputFormGroup-B7mKwzkx.js";import{R as y}from"./ReactAppend-DPXaoPQG.js";import{D as q}from"./DxButton-CsjWvhyj.js";import{S as ne}from"./SwitchFormGroup-SB6Qzl6-.js";import{I as te}from"./ImageFormGroup-Csvj9Cte.js";import{S as b}from"./sweetalert2.all-DJo0UVK6.js";import{B as ie}from"./Results-BBVbNL2k.js";import{r as x}from"./DxBox-DZgBbgD6.js";import{T as re}from"./TextareaFormGroup-B4XWcpu0.js";import{S as P}from"./SelectFormGroup-CVn9r_7Q.js";import"./index-CXU7o9CY.js";import"./tippy-react.esm-DYFqe69e.js";/* empty css              */import"./Logout-BlWggqgx.js";import"./main-Y8JAyXgE.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./index.esm-zkRd-kwu.js";import"./axios-B4uVmeYG.js";import"./useTranslation-CZbMeh78.js";import"./Filter-CpekYgBC.js";/* empty css               */class oe extends ie{constructor(){super(...arguments);C(this,"path","admin/banners");C(this,"hasFiles",!0)}}const u=new oe,se=({sections:o,positions:s,sectionPositions:l,multipleAllowedPositions:h})=>{const m=r.useRef(),g=r.useRef(),v=r.useRef(),j=r.useRef(),R=r.useRef(),p=r.useRef(),w=r.useRef(),B=r.useRef(),S=r.useRef(),c=r.useRef(),T=r.useRef(),[z,E]=r.useState(!1),[V,D]=r.useState("home"),[W,_]=r.useState(l.home||{}),A=e=>{D(e);const n=l[e]||{};_(n);const i=Object.keys(n)[0];c.current&&(c.current.value=i||"",$(c.current).trigger("change"))},M=e=>{e!=null&&e.id?E(!0):E(!1);const n=(e==null?void 0:e.section)??"home",i=(e==null?void 0:e.position)??Object.keys(l[n]||{})[0];D(n),_(l[n]||{}),v.current.value=(e==null?void 0:e.id)??"",j.current.value=(e==null?void 0:e.name)??"",R.current.value=(e==null?void 0:e.description)??"",p.image.src=`/api/banners/media/${e==null?void 0:e.image}`,p.current.value=null,w.current.value=(e==null?void 0:e.button_text)??"",B.current.value=(e==null?void 0:e.button_link)??"",S.current.value=n,c.current.value=i,T.current.value=(e==null?void 0:e.order)??0,$(g.current).modal("show")},L=async e=>{e.preventDefault();try{const n=S.current.value,i=c.current.value,d=v.current.value;let a=h.includes(i);if(i==="cambia_empresas"&&n!=="home"&&(a=!1),!a&&((await u.paginate({skip:0,take:1e3})).data||[]).find(N=>N.section===n&&N.position===i&&N.id!=d)){b.fire({icon:"warning",title:"Banner duplicado",text:`Ya existe un banner para la sección "${o[n]}" en la posición "${l[n][i]}". Solo se permite un banner por posición para esta ubicación.`,confirmButtonText:"Entendido"});return}const I={id:d||void 0,name:j.current.value,description:R.current.value,button_text:w.current.value,button_link:B.current.value,section:n,position:i,order:parseInt(T.current.value)||0},k=new FormData;for(const F in I)k.append(F,I[F]);const G=p.current.files[0];G&&k.append("image",G);const O=await u.save(k);if(console.log(O),!O)return;console.log("Refrescando tabla..."),$(m.current).dxDataGrid("instance").refresh(),console.log("Cerrando modal..."),$(g.current).modal("hide")}catch(n){console.error("Error al enviar el formulario:",n),n.message&&n.message.includes("Ya existe un banner")?b.fire({icon:"warning",title:"Banner duplicado",text:n.message,confirmButtonText:"Entendido"}):b.fire({icon:"error",title:"Error",text:"Hubo un error al enviar el formulario. Por favor, inténtalo de nuevo."})}},Y=async({id:e,value:n})=>{await u.boolean({id:e,field:"visible",value:n})&&$(m.current).dxDataGrid("instance").refresh()},H=async e=>{const{isConfirmed:n}=await b.fire({title:"Eliminar banner",text:"¿Estás seguro de eliminar este banner?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!n||!await u.delete(e)||$(m.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(Z,{gridRef:m,title:"Banners",rest:u,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo banner",hint:"Nuevo banner",onClick:()=>M()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"image",caption:"Imagen",width:"80px",allowFiltering:!1,cellTemplate:(e,{data:n})=>{y(e,t.jsx("img",{src:`/api/banners/media/${n.image}`,style:{width:"70px",height:"40px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"}}))}},{dataField:"name",caption:"Contenido",width:"40%",cellTemplate:(e,{data:n})=>{y(e,t.jsxs("div",{children:[t.jsx("p",{className:"mb-1",children:t.jsx("b",{children:n.name})}),n.description&&t.jsx("small",{className:"text-wrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:n.description}),n.button_text&&t.jsx("div",{className:"mt-1",children:t.jsx("small",{className:"badge badge-info",children:n.button_text})})]}))}},{dataField:"section",caption:"Sección",width:"120px",cellTemplate:(e,{data:n})=>{const i=o[n.section]||n.section;e.html(x(t.jsx("span",{className:"badge text-black badge-primary",children:i})))}},{dataField:"position",caption:"Posición",width:"150px",cellTemplate:(e,{data:n})=>{const d=(l[n.section]||{})[n.position]||n.position;let a=h.includes(n.position);n.position==="cambia_empresas"&&n.section!=="home"&&(a=!1),e.html(x(t.jsxs("div",{children:[t.jsx("span",{className:"badge text-black badge-secondary",children:d}),t.jsx("br",{}),t.jsx("small",{className:`text-${a?"success":"warning"}`,children:a?"Múltiples permitidos":"Solo uno permitido"})]})))}},{dataField:"order",caption:"Orden",width:"80px",dataType:"number"},{dataField:"button_link",caption:"Mensaje personalizado",cellTemplate:(e,{data:n})=>{n.button_link?e.html(x(t.jsx("a",{href:"#",className:"text-truncate d-block",style:{maxWidth:"200px"},children:n.button_link}))):e.html(x(t.jsx("i",{className:"text-muted",children:"- Sin mensaje personalizado -"})))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"120px",cellTemplate:(e,{data:n})=>{y(e,t.jsx(ne,{checked:n.visible,onChange:i=>Y({id:n.id,value:i.target.checked})}))}},{caption:"Acciones",cellTemplate:(e,{data:n})=>{e.css("text-overflow","unset"),e.append(q({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>M(n)})),e.append(q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>H(n.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(ee,{modalRef:g,title:z?"Editar banner":"Agregar banner",onSubmit:L,size:"lg",children:t.jsxs("div",{className:"row",id:"form-banner",children:[t.jsx("input",{ref:v,type:"hidden"}),t.jsx(te,{eRef:p,label:"Imagen del banner",col:"col-md-4",aspect:2.5,fit:"cover",required:!0}),t.jsxs("div",{className:"col-md-8",children:[t.jsx(f,{eRef:j,label:"Título del banner",required:!0}),t.jsx(re,{eRef:R,label:"Descripción",rows:2}),t.jsxs("div",{className:"row",children:[t.jsx(f,{eRef:w,label:"Texto del botón",col:"col-md-6"}),t.jsx(f,{eRef:B,label:"Mensaje personalizado del botón",col:"col-md-6"})]})]}),t.jsx(P,{eRef:S,label:"Sección",col:"col-md-4",required:!0,dropdownParent:"#form-banner",onChange:e=>A(e.target.value),children:Object.entries(o).map(([e,n])=>t.jsx("option",{value:e,children:n},e))}),t.jsx(P,{eRef:c,label:"Posición",col:"col-md-4",required:!0,dropdownParent:"#form-banner",children:Object.entries(W).map(([e,n])=>{let i=h.includes(e);return e==="cambia_empresas"&&V!=="home"&&(i=!1),t.jsxs("option",{value:e,children:[n,i?" (Múltiples permitidos)":" (Solo uno)"]},e)})}),t.jsx(f,{eRef:T,label:"Orden",type:"number",col:"col-md-4",defaultValue:0})]})})]})};X((o,s)=>{Q(o).render(t.jsx(U,{...s,title:"Banners",children:t.jsx(se,{...s})}))});
